# Тестовое задание в Kazdream

## Описание проекта

Этот проект представляет собой бэкенд-сервис, который по запросу извлекает данные из WHOIS-сервиса на сайте ps.kz и возвращает их в формате JSON. Сервис сохраняет логи запросов в базы данных PostgreSQL и MongoDB в зависимости от выбранного маршрута. Дополнительно, данные WHOIS кэшируются в Redis для повышения производительности.

## Структура проекта

```bash
.
├── backend
│   ├── alembic.ini                   # Конфигурация Alembic для миграций базы данных
│   ├── dockerfiles
│   │   └── dev.dockerfile            # Dockerfile для разработки
│   ├── migration                     # Папка для миграций базы данных
│   ├── mongodata                     # Данные MongoDB
│   ├── nginx
│   │   └── nginx.conf                # Конфигурация NGINX
│   ├── pgdata                        # Данные PostgreSQL
│   ├── requirements
│   │   └── requirements.txt          # Список зависимостей Python
│   └── src
│       ├── config.py                 # Конфигурация приложения
│       ├── constants.py              # Константы, используемые в проекте
│       ├── main.py                   # Основной файл приложения
│       ├── usingNoSql                # Модуль для работы с MongoDB
│       ├── usingSql                  # Модуль для работы с PostgreSQL
│       ├── models.py                 # Модели базы данных
│       └── utils
│           └── parser.py             # Утилиты для парсинга данных WHOIS
├── docker-compose.yml                # Файл Docker Compose
└── tasks.txt                         # Задачи для разработки
```

## Основные возможности

- Два маршрута для выполнения WHOIS-запросов:
  - `/api/nosql/lookup_whois` — сохраняет логи в MongoDB.
  - `/api/sql/lookup_whois` — сохраняет логи в PostgreSQL.
- Кэширование WHOIS данных в Redis на 24 часа для ускорения повторных запросов.
- Поддержка контейнеризации с использованием docker compose.
- Возможность работы с различными базами данных (PostgreSQL, MongoDB).

## Документация API

Документация для API доступна по адресу: [http://217.15.168.46:557/docs](http://217.15.168.46:557/docs). Здесь вы можете просмотреть доступные конечные точки, их параметры и примеры ответов.

## Инструкции по запуску

1. Клонируйте репозиторий с проектом:
   ```bash
   git clone https://github.com/Jlumon4ek/Test-task-to-Kazdream.git
   cd Test-task-to-Kazdream
   ```

2. Поднимите все необходимые контейнеры с помощью Docker Compose:
   ```bash
   docker compose up --build -d
   ```

3. Войдите в контейнер backend:
   ```bash
   docker exec -it api-backend sh
   ```

4. Внутри контейнера выполните миграции для создания таблицы логов в PostgreSQL:
   ```bash
   cd ..
   alembic revision --autogenerate -m "create logs table"
   alembic upgrade head
   ```

## Базы данных

- **PostgreSQL**: используется для хранения логов в реляционном формате.
- **MongoDB**: используется для хранения логов в документ-ориентированном формате.
- **Redis**: используется для кэширования данных WHOIS на 24 часа.

## Контейнеры

- **backend**: основной сервис API.
- **redis**: контейнер Redis для кэширования данных WHOIS.
- **postgres**: контейнер PostgreSQL для реляционных данных.
- **mongo**: контейнер MongoDB для документ-ориентированных данных.
- **nginx**: NGINX используется в качестве обратного прокси-сервера для API.

## Ограничение скорости запросов

Для защиты от перегрузки и злоупотребления сервисом, реализовано ограничение скорости запросов (rate limiting). Каждый клиент может отправлять не более одного запроса каждые 5 секунд. Это реализовано с использованием `SlowAPI` и middleware для FastAPI.
